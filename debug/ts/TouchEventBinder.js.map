{"version":3,"file":"TouchEventBinder.js","sourceRoot":"","sources":["TouchEventBinder.ts"],"names":[],"mappings":"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","sourcesContent":["import {Editor} from \"../../src/Editor\";\n\nclass Point {\n\tx: number;\n\ty: number;\n\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n}\n\nexport class TouchEventBinder {\n\n\treadonly touchStart: ( event: TouchEvent) => void;\n\treadonly touchEnd: ( event: TouchEvent) => void;\n\treadonly touchMove: ( event: TouchEvent) => void;\n\n\treadonly mouseMove: (event: MouseEvent) => void;\n\treadonly mouseDown: (event: MouseEvent) => void;\n\treadonly mouseUp: (event: MouseEvent) => void;\n\treadonly mouseOut: (event: MouseEvent) => void;\n\n\tprivate element: Element | null;\n\tprivate touchMoving: boolean;\n\tprivate mouseMoving: boolean;\n\tprivate click: boolean;\n\tprivate lPointX: number;\n\tprivate lPointY: number;\n\tprivate lForce: number | undefined | null;\n\n\tconstructor(\n\t\tprivate editor: Editor\n\t) {\n\n\t\tthis.touchMoving = true;\n\t\tthis.touchMoving = false;\n\t\tthis.mouseMoving = false;\n\t\tthis.click = false;\n\t\tthis.lPointX = 0 | 0;\n\t\tthis.lPointY = 0 | 0;\n\t\tthis.lForce = null;\n\t\tthis.element = null;\n\n\t\tthis.touchStart = (ev: TouchEvent) => {\n\n\t\t\tthis.flush();\n\n\t\t\t// マルチタップはサポートしない。\n\t\t\tif (ev.touches.length > 1) {\n\t\t\t\tthis.touchMoving = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.touchMoving = true;\n\t\t\tev.preventDefault();\n\t\t\tconst touch: Touch = ev.touches[0];\n\t\t\tconst force = (<any>touch).force;\n\t\t\tthis.setStart(touch, force);\n\t\t};\n\n\t\tthis.touchMove = (ev: TouchEvent) => {\n\n\t\t\tif (!this.touchMoving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tev.preventDefault();\n\n\t\t\t// マルチタップはサポートしない。\n\t\t\tif (ev.touches.length > 1) {\n\t\t\t\tthis.flush();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst touch: Touch = ev.touches[0];\n\t\t\tconst force = (<any>touch).force;\n\t\t\tthis.setMove(touch, force);\n\t\t};\n\n\t\tthis.touchEnd = (ev: TouchEvent) => {\n\t\t\tif (!this.touchMoving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tev.preventDefault();\n\t\t\tthis.flush();\n\t\t};\n\n\t\tthis.mouseMove = (event: MouseEvent) => {\n\t\t\tif (this.touchMoving || !this.click) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.mouseMoving = true;\n\t\t\tthis.setMove(event);\n\t\t};\n\n\t\tthis.mouseDown = (event: MouseEvent) => {\n\t\t\tif (this.touchMoving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.click = true;\n\t\t\tthis.setStart(event);\n\t\t};\n\n\t\tthis.mouseUp = (event: MouseEvent) => {\n\t\t\tif (this.touchMoving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.flush();\n\t\t};\n\n\t\tthis.mouseOut = (event: MouseEvent) => {\n\t\t\tif (this.touchMoving) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.flush();\n\t\t};\n\t}\n\n\tprivate setStart(event: MouseEvent | Touch, force?: number | null): void {\n\t\tlet point = this.getOffset(this.element!, event);\n\t\tthis.lPointX = point.x | 0;\n\t\tthis.lPointY = point.y | 0;\n\t\tthis.lForce = force;\n\t\tthis.editor.canvas.touchStart(point.x, point.y, force);\n\t}\n\n\tprivate setMove(event: MouseEvent | Touch, force?: number | null): void {\n\t\tlet point = this.getOffset(this.element!, event);\n\t\tthis.lPointX = point.x | 0;\n\t\tthis.lPointY = point.y | 0;\n\t\tthis.lForce = force;\n\t\tthis.editor.canvas.touchMove(point.x, point.y, force);\n\t}\n\n\tprivate flush(): void {\n\t\tif (!this.touchMoving && !this.mouseMoving) {\n\t\t\treturn;\n\t\t}\n\t\tthis.touchMoving = false;\n\t\tthis.mouseMoving = false;\n\t\tthis.click = false;\n\t\tthis.editor.canvas.touchEnd(this.lPointX, this.lPointY, this.lForce);\n\t}\n\n\tbind(element: Element) {\n\t\tthis.element = element;\n\n\t\tdocument.addEventListener(\"mousemove\", this.mouseMove);\n\t\telement.addEventListener(\"mousedown\", this.mouseDown);\n\t\tdocument.addEventListener(\"mouseup\", this.mouseUp, true);\n\t\t// element.addEventListener(\"mouseout\", this.mouseOut);\n\n\t\telement.addEventListener(\"touchstart\", this.touchStart);\n\t\tdocument.addEventListener(\"touchmove\", this.touchMove);\n\t\tdocument.addEventListener(\"touchend\", this.touchEnd, true);\n\t\tdocument.addEventListener(\"touchcancel\", this.touchEnd, true);\n\t}\n\n\tunBind(): void {\n\n\t\tif (this.element === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst element = this.element;\n\t\tthis.element = null;\n\n\t\tdocument.removeEventListener(\"mousemove\", this.mouseMove);\n\t\telement.removeEventListener(\"mousedown\", this.mouseDown);\n\t\tdocument.removeEventListener(\"mouseup\", this.mouseUp, true);\n\t\t// element.removeEventListener(\"mouseout\", this.mouseOut);\n\n\t\telement.removeEventListener(\"touchstart\", this.touchStart);\n\t\tdocument.removeEventListener(\"touchmove\", this.touchMove);\n\t\tdocument.removeEventListener(\"touchend\", this.touchEnd, true);\n\t\tdocument.removeEventListener(\"touchcancel\", this.touchEnd, true);\n\t}\n\n\tprivate getOffset(element: Element, event: MouseEvent | Touch): Point {\n\t\tlet mouseX = event.pageX;\n\t\tlet mouseY = event.pageY;\n\t\tlet rect = element.getBoundingClientRect();\n\t\tlet positionX = rect.left + window.pageXOffset;\n\t\tlet positionY = rect.top + window.pageYOffset;\n\t\treturn new Point(\n\t\t\tmouseX - positionX,\n\t\t\tmouseY - positionY\n\t\t);\n\t}\n}\n"]}